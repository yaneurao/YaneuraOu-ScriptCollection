#set file mate\mate1ply_without_effect.cpp
#context

	Move mate_1ply(const Position& pos)
	{
		return pos.side_to_move() == BLACK ? Mate::mate_1ply_imp<BLACK>(pos) : Mate::mate_1ply_imp<WHITE>(pos);
	}

#add

	Move mate_1ply(const Position& pos)
	{
    	// 現局面で1手詰めであるかを判定する。1手詰めであればその指し手を返す。
		// 王手将棋のために1手詰め判定を差し替える。
		// 💡 王手の指し手が1手でもあるなら、(これは詰みなので)1つ目の指し手を返す。
		//     さもなくば、noneを返す。		
		MoveList<CHECKS> list(pos);
        return list.size() ? list.at(0) : Move::none();
    }

#set file position.cpp
#context

bool Position::legal(Move m) const
{

#add

bool Position::legal(Move m) const
{

	// 王手将棋の場合、王手がかかっているならこの局面の合法手は存在しない。
    if (checkers())
        return false;

