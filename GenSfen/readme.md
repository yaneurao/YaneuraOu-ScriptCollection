# GenSfen

教師局面の生成を行うためのスクリプトです。

USIプロトコル対応のエンジンを用いて教師データの生成を行います。

ここで生成した教師データは、pack形式となります。このpack形式は、hcpe形式に変換することができ、dlshogiの学習スクリプトである`train.py`で用いることができます。


# pack形式データフォーマット

ここで紹介するpack形式は、ファイルサイズを限りなく小さくする目的でやねうらおが考案しました。

対局棋譜がほぼそのままバイナリーデータとなります。

以下では、

- `:=`は定義。左側の定義が右側に来る。
- `*`は0回以上の繰り返し
- `+`は1回以上の繰り返し
- `:` この右側に説明を書くための記号

を意味するものとします。

また、エンディアンはLE(Little Endian)であるものとします。

💡 比較的BNF記法に近い。BNF記法を参照すること。

pack形式のデータ := 対局棋譜*

対局棋譜 := 開始局面 (指し手 評価値)* 終端記号

開始局面 :=
-    0(1byte) : startpos(平手の初期局面)
-    1(1byte) PackedSfen(32byte)

📝 0が1byteであったときは、平手の開始局面。1が1byteであったときは、そのあとにPackedSfen形式(32byteに符号化された局面データ。これはやねうら王で用いられるもの)が来るという意味。

指し手 := やねうら王のMove16(2byte)

評価値 := 符号付き16bit整数(2byte)

終端記号 := 0(2byte) 終局状態(1byte)

終局状態 :=
- 0(1byte) reserved : 終端記号の0と紛らわしいので0は使わない。
- 1(1byte) draw : 千日手引き分け。
- 2(1byte) max moves : 最大手数による引き分け。
- 3(1byte) resign : 投了。非手番側の勝ち。
- 4(1byte) illegal move : 反則手。非手番側の勝ち。
- 5(1byte) win : 入玉宣言勝ち。手番側の勝ち。


